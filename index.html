<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Camp Attendance Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background: #f4f6f8; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center; }
h2 { text-align:center; margin-bottom:20px; }
#video { width: 100%; max-width: 400px; border: 2px solid #ccc; border-radius:12px; }
#result { margin-top:20px; font-size:16px; font-weight:bold; }
#attendeeInfo { margin-top:10px; padding:10px; border:1px solid #ccc; border-radius:8px; background:#fff; width:100%; max-width:400px; text-align:center; }
#attendeeInfo.highlight { border-color: #28a745; background: #e1f7e7; }
</style>
</head>
<body>

<h2>Camp Attendance Scanner</h2>
<video id="video" autoplay></video>
<div id="result">Scan a QR code...</div>
<div id="attendeeInfo"></div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxqR1FoRQL3K_59LBkwOcpgr-jAmAmDonSNfpROKDyA8i-EmnvOwO3od3f0ZX4p3za2DQ/exec";

const resultDiv = document.getElementById('result');
const attendeeDiv = document.getElementById('attendeeInfo');

function markPresent(id){
  fetch(SCRIPT_URL + "?id=" + encodeURIComponent(id), {
    method: "GET"
  })
  .then(res => res.json())
  .then(data => {
    if(data.found){
      resultDiv.textContent = "✅ Attendee Found!";
      attendeeDiv.innerHTML = `
        Name: ${data.name} <br>
        Age: ${data.age} <br>
        Sex: ${data.sex} <br>
        Church: ${data.church} <br>
        Accommodation: ${data.accommodation} <br>
        Contact: ${data.contact} <br>
        Status: Present
      `;
      attendeeDiv.classList.add('highlight');
    } else {
      resultDiv.textContent = "❌ QR ID not found!";
      attendeeDiv.innerHTML = "";
      attendeeDiv.classList.remove('highlight');
    }
  })
  .catch(err => {
    resultDiv.textContent = "❌ Error fetching data";
    console.error(err);
  });
}

// Initialize QR scanner
const html5QrCode = new Html5Qrcode("video");
html5QrCode.start(
  { facingMode: "environment" },
  {
    fps: 10,
    qrbox: 250
  },
  (decodedText) => {
    markPresent(decodedText);
  },
  (errorMessage) => {
    // ignore scan errors
  }
).catch(err => {
  resultDiv.textContent = "❌ Error accessing camera";
  console.error(err);
});
</script>
</body>
</html>
